<div class="container">
  <h2>RSVP for Events</h2>

  <table mat-table [dataSource]="events" class="mat-elevation-z8" *ngIf="events.length > 0">
    <!-- Select Column -->
    <ng-container matColumnDef="select">
      <th mat-header-cell *matHeaderCellDef>
        <mat-checkbox
          (change)="toggleAll()"
          [checked]="allSelected"
          [indeterminate]="someSelected()">
        </mat-checkbox>
      </th>
      <td mat-cell *matCellDef="let event">
        <mat-checkbox
          [(ngModel)]="event.selected"
          (ngModelChange)="onSelectionChange(event)">
        </mat-checkbox>
      </td>
    </ng-container>

    <!-- Image Column -->
    <ng-container matColumnDef="image">
      <th mat-header-cell *matHeaderCellDef> Image </th>
      <td mat-cell *matCellDef="let event">
        <img [src]="event.image" class="event-image" alt="{{event.name}}">
      </td>
    </ng-container>

    <!-- Name Column -->
    <ng-container matColumnDef="name">
      <th mat-header-cell *matHeaderCellDef> Name </th>
      <td mat-cell *matCellDef="let event"> {{ event.name }} </td>
    </ng-container>

    <!-- Date Column -->
    <ng-container matColumnDef="date">
      <th mat-header-cell *matHeaderCellDef> Date </th>
      <td mat-cell *matCellDef="let event"> {{ event.date }} </td>
    </ng-container>

    <!-- Location Column -->
    <ng-container matColumnDef="location">
      <th mat-header-cell *matHeaderCellDef> Location </th>
      <td mat-cell *matCellDef="let event"> {{ event.location }} </td>
    </ng-container>

    <!-- RSVP Toggle Column -->
    <ng-container matColumnDef="rsvp">
      <th mat-header-cell *matHeaderCellDef> RSVP </th>
      <td mat-cell *matCellDef="let event">
        <mat-slide-toggle
          [(ngModel)]="event.rsvpStatus"
          (change)="updateRsvpStatus(event)"
          [disabled]="!event.selected">
          {{ event.rsvpStatus ? 'Yes' : 'No' }}
        </mat-slide-toggle>
      </td>
    </ng-container>

    <!-- Comments Column -->
    <ng-container matColumnDef="comments">
      <th mat-header-cell *matHeaderCellDef> Comments </th>
      <td mat-cell *matCellDef="let event">
        <mat-form-field *ngIf="event.selected && event.rsvpStatus" appearance="outline">
          <textarea matInput [(ngModel)]="event.comments" placeholder="Comments"></textarea>
        </mat-form-field>
      </td>
    </ng-container>

    <!-- Guest Column -->
    <ng-container matColumnDef="guest">
      <th mat-header-cell *matHeaderCellDef> For Guest </th>
      <td mat-cell *matCellDef="let event">
        <mat-form-field *ngIf="event.selected && event.rsvpStatus && isAdmin" appearance="outline">
          <input matInput [(ngModel)]="event.forGuest" placeholder="Guest name">
        </mat-form-field>
      </td>
    </ng-container>

    <!-- Adults Column -->
    <ng-container matColumnDef="adults">
      <th mat-header-cell *matHeaderCellDef> Adults </th>
      <td mat-cell *matCellDef="let event">
        <mat-form-field *ngIf="event.selected && event.rsvpStatus" appearance="outline">
          <mat-select [(ngModel)]="event.adults">
            <mat-option *ngFor="let num of adultOptions" [value]="num">{{ num }}</mat-option>
          </mat-select>
        </mat-form-field>
      </td>
    </ng-container>

    <!-- Children Column -->
    <ng-container matColumnDef="children">
      <th mat-header-cell *matHeaderCellDef> Children </th>
      <td mat-cell *matCellDef="let event">
        <mat-form-field *ngIf="event.selected && event.rsvpStatus" appearance="outline">
          <mat-select [(ngModel)]="event.children">
            <mat-option *ngFor="let num of childrenOptions" [value]="num">{{ num }}</mat-option>
          </mat-select>
        </mat-form-field>
      </td>
    </ng-container>

    <!-- Header and Row definitions -->
    <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns; trackBy: trackByEventId"></tr>
  </table>

  <div *ngIf="events.length === 0" class="no-data">
    No events available.
  </div>

  <div class="button-row">
    <button mat-raised-button
            color="primary"
            (click)="submitRSVP()"
            [disabled]="!hasSelectedEvents()">
      Submit RSVP
    </button>
  </div>
</div>
