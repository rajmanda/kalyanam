<div class="gallery-container">
  <!-- Header with title and upload button -->
  <div class="gallery-header">
    <h2>Photo Gallery</h2>
    <div class="upload-container">
      <button mat-raised-button color="primary" (click)="triggerFileInput()" [disabled]="isUploading">
        <mat-icon>cloud_upload</mat-icon> Upload Photo
      </button>
      <input
        type="file"
        id="fileInput"
        style="display: none"
        accept="image/*"
        (change)="onFileSelected($event)"
      >
    </div>
  </div>

  <!-- Upload progress bar -->
  <div *ngIf="isUploading" class="upload-progress">
    <mat-progress-bar mode="determinate" [value]="uploadProgress"></mat-progress-bar>
    <div class="progress-text">Uploading: {{uploadProgress}}%</div>
  </div>

  <!-- Error message -->
  <div *ngIf="errorMessage" class="error-message">
    <mat-icon>error_outline</mat-icon>
    <span>{{ errorMessage }}</span>
  </div>

  <!-- View tabs -->
  <mat-tab-group (selectedTabChange)="onTabChange($event)">
    <mat-tab label="All Photos">
      <ng-template mat-tab-label>
        <mat-icon class="tab-icon">photo_library</mat-icon>
        All Photos
      </ng-template>
      <div *ngIf="isLoading; else galleryContent" class="loading-message">
        <mat-spinner></mat-spinner>
        <p>Loading images...</p>
      </div>
      <ng-template #galleryContent>
        <div class="picture-grid">
          <div *ngFor="let image of filteredImages" class="picture-item" (click)="onImageClick(image)">
            <div class="picture-image-container">
              <img [src]="image.url" loading="lazy" [alt]="'Image uploaded by ' + (image.uploadedBy || 'unknown user')" class="picture-image" />
            </div>
            <div class="picture-meta">
              <span class="uploader" *ngIf="image.uploadedBy">
                <mat-icon>person</mat-icon> {{ image.uploadedBy }}
              </span>
              <span class="date" *ngIf="image.uploadedAt">
                <mat-icon>schedule</mat-icon> {{ image.uploadedAt | date:'medium' }}
              </span>
            </div>
          </div>
          <div *ngIf="filteredImages.length === 0" class="empty-state">
            <mat-icon>photo_library</mat-icon>
            <p>No photos found. Be the first to upload one!</p>
          </div>
        </div>
      </ng-template>
    </mat-tab>

    <mat-tab label="My Photos">
      <ng-template mat-tab-label>
        <mat-icon class="tab-icon">person</mat-icon>
        My Photos
      </ng-template>
      <div *ngIf="isLoading; else myPhotosContent" class="loading-message">
        <mat-spinner></mat-spinner>
        <p>Loading your photos...</p>
      </div>
      <ng-template #myPhotosContent>
        <div class="picture-grid">
          <div *ngFor="let image of filteredImages" class="picture-item" (click)="onImageClick(image)">
            <div class="picture-image-container">
              <img [src]="image.url" loading="lazy" [alt]="'Image uploaded by ' + (image.uploadedBy || 'unknown user')" class="picture-image" />
            </div>
            <div class="picture-meta">
              <span class="date">
                <mat-icon>schedule</mat-icon> {{ image.uploadedAt | date:'medium' }}
              </span>
            </div>
          </div>
          <div *ngIf="filteredImages.length === 0" class="empty-state">
            <mat-icon>add_a_photo</mat-icon>
            <p>You haven't uploaded any photos yet. Click the upload button to get started!</p>
          </div>
        </div>
      </ng-template>
    </mat-tab>
  </mat-tab-group>
</div>
